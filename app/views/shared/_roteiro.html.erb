<div>
  <% Roteiro.where(book_id: @book.id).each do |roteiro| %>
    <div class="roteiro-card">
      <div class="roteiro-title d-flex justify-content-between" onclick="toggleDetails(this)">
        <strong><%= roteiro.title %></strong>
        <% if roteiro.rating %>
          <strong>Average Rating: <%= roteiro.rating.to_f.round(1) %>  <i class="fas fa-star"></i>  </strong>(<%= roteiro.reviews.count %> reviews)
        <% else %>
          <strong>No reviews yet</strong>
        <% end %>
      </div>

      <div class="roteiro-details" style="display:none;">
        <div class="details-container">
          <% if roteiro.photos.present? %>
            <div class="photo-container">

              <div class="carousel">
                <input type="radio" id="carousel-1" name="carousel[]" checked>
                <input type="radio" id="carousel-2" name="carousel[]">
                <input type="radio" id="carousel-3" name="carousel[]">
                <ul class="carousel__items">
                  <% if roteiro.photos.first.present? %>
                    <li class="carousel__item"><%= cl_image_tag roteiro.photos.first.key, class: "photo" %></li>
                  <% end %>
                  <% if roteiro.photos.second.present? %>
                    <li class="carousel__item"><%= cl_image_tag roteiro.photos.second.key, class: "photo" %></li>
                  <% end %>
                  <% if roteiro.photos.third.present? %>
                    <li class="carousel__item"><%= cl_image_tag roteiro.photos.third.key, class: "photo" %></li>
                  <% end %>
                </ul>
                <div class="carousel__prev">
                  <label for="carousel-1"></label>
                  <label for="carousel-2"></label>
                  <label for="carousel-3"></label>
                </div>
                <div class="carousel__next">
                  <label for="carousel-1"></label>
                  <label for="carousel-2"></label>
                  <label for="carousel-3"></label>
                </div>
                <div class="carousel__nav">
                  <label for="carousel-1"></label>
                  <label for="carousel-2"></label>
                  <label for="carousel-3"></label>
                </div>
              </div>
            </div>
          <% end %>
          <div>
            <ul>
              <li><strong>Created by:</strong> <%= roteiro.author %></li>
              <li><strong>Location:</strong> <%= roteiro.location %></li>
              <li><strong>Activity Description:</strong>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa <%= roteiro.activity_description %></li>
              <li><strong>Address:</strong> <%= roteiro.activity_address %></li>
              <li><strong>Time taken:</strong> <%= roteiro.estimated_time %>hours</li>
              <li><strong>Approx. Cost:</strong> R$ <%= roteiro.estimated_costs.to_i %></li>
            </ul>
          </div>
        </div>
        <div>
          <!-- Add the button code below -->
          <% if user_signed_in? %>
            <%= link_to "Add to Favorites", book_favorites_path(book_id: roteiro.book_id, roteiro_id: roteiro.id), data: {turbo_method: :post}, class: "favorite-button" %>
          <% end %>
          <%= render partial: 'shared/review', locals: { roteiro: roteiro } %>
        </div>
      </div>
    </div>
  <% end %>
  <%# #mapa add fora da iteração %>
  <strong> All pinned itineraries:  </strong>
  <div style="width: 100%; height: 600px;"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <script>
    function toggleDetails(element) {
      // Find the next sibling element which is the details container
      var details = element.nextElementSibling;
      // Toggle the display property
      if (details.style.display === "none") {
        details.style.display = "block";
      } else {
        details.style.display = "none";
      }
    }
  </script>
